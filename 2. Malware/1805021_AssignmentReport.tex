\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{multirow}
\usepackage{multicol}
\usepackage[table]{xcolor}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{hyperref}

\title{%
  \begin{center}
        \vspace*{1cm}
            
        \Huge
        \textbf{Computer Security Sessional}
            
        \vspace{0.5cm}
        \LARGE
        CSE - 406
            
        \vspace{2cm}
            
        \Huge
        \texttt{Malware Assignment Report}
                        
        \vspace{0.8cm}
                        
        \Large
        Abdus Samee\\
        ID: 1805021\\
        Section: A\\
        Dept: CSE\\
    \end{center}
  } 

\date{}

\begin{document}

\maketitle
\newpage

Some of the following things remained constant throughout all of the tasks:
\begin{itemize}
    \item The username of each docker container is \textbf{root}
    \item The password of each docker container is \textbf{mypassword}
    \item The same aliases \textbf{dockps} and \textbf{docksh} were used to gather docker information and connect to containers
\end{itemize}

\section{Task 1}
\begin{itemize}
    \item The docker containers $6$ and $7$ were assigned as the \textit{attacked} hosts
    \item The docker container $8$ assigned as the \textit{designated host} where the exfiltrated files would be uploaded
\end{itemize}

\subsection{Docker Container Information}
We get the ip addresses of the desired docker containers using the following aliases in the Ubuntu cloud VM. The command \textbf{dockps} is used to find all the container ids and the command \textbf{docksh} is used to connect to a particular docker container.
\begin{center}
    \includegraphics[scale=0.3]{task1/docker.png}
\end{center}

The following function returns a list of ip addresses of docker container $6$ and $7$ respectively. All the files ending with the extension \textbf{foo} and containing the string \textbf{foovirus} would be exfiltrated from these containers.
\begin{center}
    \includegraphics[scale=0.3]{task1/ip.png}
\end{center}

With the following line in the code, we connect to the docker container $8$. The exfiltrated files are uploaded at this location.
\begin{center}
    \includegraphics[scale=0.3]{task1/target.png}
\end{center}

The username and passwords are obtained using the following functions. Note, all the containers have the same username \textbf{root} and same password \textbf{mypassword}.
\begin{center}
    \includegraphics[scale=0.25]{task1/username.png}
\end{center}
\begin{center}
    \includegraphics[scale=0.25]{task1/password.png}
\end{center}


\subsection{Obtain Target Files}
We find all the \textbf{foo} files with the string \textbf{foovirus} at the top-level directory of a docker container executing the command below:
\begin{center}
    \includegraphics[scale=0.3]{task1/cmd.png}
\end{center}

Then we get all the target files at the attacking program:
\begin{center}
    \includegraphics[scale=0.5]{task1/get_from_host.png}
\end{center}

The main part comes after this. A copy of the virus is kept at the \textit{attacked} machine:
\begin{center}
    \includegraphics[scale=0.3]{task1/copy.png}
\end{center}

We can also see the exfiltrated foo files' contents being commented out by the actual virus code in the attacker code. Also, executing the virus code in the docker containers will also infect their foo files. 

\begin{center}
    \includegraphics[scale=0.25]{task1/infect.png}
\end{center}
The above function does the following:
\begin{itemize}
    \item Counts the total number of lines of the attacking virus code
    \item Adds the contents of the virus code at the beginning of the \textbf{foo} file
    \item Comments out the contents of the \textbf{foo} file
\end{itemize}


\subsection{Upload Exfiltrated Files}
After connecting to the container $8$, the exfiltrated files are uploaded normally as follows: 
\begin{center}
    \includegraphics[scale=0.3]{task1/file-transfer.png}
\end{center}


\subsection{Prepare Docker Containers}
We prepare the docker containers as follows:\\\\
The container $6$ has one \textbf{foo} file.
\begin{center}
    \includegraphics[scale=0.25]{task1/cont6.png}
\end{center}
The container $7$ has a \textbf{foo} file without \textbf{\textit{foovirus}} and a \textbf{foo} file with the desired string.
\begin{center}
    \includegraphics[scale=0.25]{task1/cont7.png}
\end{center}
The container $8$ is currently empty before the execution of the program.
\begin{center}
    \includegraphics[scale=0.25]{task1/cont8.png}
\end{center}


\subsection{Containers after Execution}
The program \textbf{1805021\_1.py} was run and the docker containers had the following desired states:\\\\

The container $6$ now has an identical copy of the attacking program, along with the $1$ \textbf{foo} file it had before. 
\begin{center}
    \includegraphics[scale=0.25]{task1/cont6_after.png}
\end{center}

The container $7$ also has an identical copy of the attacking program, along with the \textbf{foo} files it had before. 
\begin{center}
    \includegraphics[scale=0.25]{task1/cont7_after.png}
\end{center}

The container $8$ now has all the $2$ \textbf{foo} files without the desired string \textbf{foovirus}, but does not have the \textbf{foo} file with the same desired string from container $7$.
\begin{center}
    \includegraphics[scale=0.25]{task1/cont8_after.png}
\end{center}

Thus, we can say that the virus \textbf{1805021\_1.py} now has the ability to hop into other machines, along with filtering \textbf{foo} files like before.

\vspace{2cm}
 \section{Task 2}
 \begin{itemize}
     \item The docker containers $3$ and $4$ were assigned as the \textit{attacked} hosts
     \item The docker container $5$ was assigned as the \textit{target} destination host where exfiltrated files will be uploaded
     \item Each of the copy of the worm \textbf{1805021\_2.py} would be unique in container $3$ and $4$
 \end{itemize}

 \subsection{Docker Container Information}
 The following function returns the ip addresses of the docker containers $3$ and $4$, from which all the files at the top-level directory containing the desired string \textbf{\textit{abracadabra}} will be exfiltrated:
\begin{center}
    \includegraphics[scale=0.3]{task2/attacked-hosts.png}
\end{center}

With the following line of code, we connect to the docker container $5$, where the exfiltrated files will be uploaded:
\begin{center}
    \includegraphics[scale=0.3]{task2/target-host.png}
\end{center}


 \subsection{Obtain Target Files}
We find all \textbf{sorts} of files with the string \textbf{\textit{abracadabra}} at the top-level directory of a docker container executing the command below:
\begin{center}
    \includegraphics[scale=0.3]{task2/cmd.png}
\end{center}

The network portions in all of the worms are the same.


\subsection{Upload Exfiltrated Files}
After connecting to the container $5$, the exfiltrated files are uploaded normally as follows: 
\begin{center}
    \includegraphics[scale=0.3]{task1/file-transfer.png}
\end{center}


 \subsection{Change Worm File}
 A function to add a minimum of $50$ newlines at random lines of the attacking worm file which would be deposited at the \textit{attacked} host.
 \begin{center}
    \includegraphics[scale=0.3]{task2/newline.png}
\end{center}

A function to add a maximum of $50$ characters at random places inside every comment of the worm file.
\begin{center}
    \includegraphics[scale=0.25]{task2/character.png}
\end{center}

\subsection{Deposit Unique Copy}
A unique copy of the worm file is deposited at the \textit{attacked} host by calling the function as follows after all the target files have been exfiltrated:
\begin{center}
    \includegraphics[scale=0.25]{task2/unique-copy.png}
\end{center}

The function above makes $1$ of $4$ choices:
\begin{itemize}
    \item Add random newlines in the worm file
    \item Add random characters in every comment of the worm file
    \item Add random characters followed by the addition of random newlines
    \item Add random newlines followed by the addition of random characters
\end{itemize}

The above function is called as follows:
\begin{center}
    \includegraphics[scale=0.3]{task2/host1-to-attacker.png}
\end{center}

\subsection{Prepare Docker Containers}
We prepare the docker containers as follows:\\\\
The container $3$ has a \textbf{txt} file with desired string \textbf{\textit{abracadabra}}.
\begin{center}
    \includegraphics[scale=0.25]{task2/cont3.png}
\end{center}
The container $4$ has a \textbf{bar} file with the desired string \textbf{\textit{abracadabra}}.
\begin{center}
    \includegraphics[scale=0.25]{task2/cont4.png}
\end{center}
The container $5$ is currently empty before the execution of the program.
\begin{center}
    \includegraphics[scale=0.25]{task2/cont5.png}
\end{center}


\subsection{Containers after Execution}
The program \textbf{1805021\_2.py} was run and the docker containers had the following desired states:\\\\

The container $3$ now has a copy of the attacking program \textbf{modified.txt}, along with the \textbf{txt} files it had before. 
\begin{center}
    \includegraphics[scale=0.25]{task2/cont3_after.png}
\end{center}

The container $4$ also has a unique copy of the attacking program \textbf{modified.txt} which is different from the copy stored in container $3$, along with the \textbf{bar} file it had before. 
\begin{center}
    \includegraphics[scale=0.25]{task2/cont4_after.png}
\end{center}

The container $5$ now has the $2$ files with the desired string \textbf{\textit{abracadabra}}.
\begin{center}
    \includegraphics[scale=0.25]{task2/cont5_after.png}
\end{center}

Thus, we can say that the worm \textbf{1805021\_2.py} now can deposit unique copies into the machines it attacks.


                                                            % TASK 3
\vspace{3cm}
\section{Task 3}
 \begin{itemize}
     \item The docker containers $3$ and $4$ were assigned as the \textit{attacked} hosts
     \item The docker container $5$ was assigned as the \textit{target} destination host where exfiltrated files will be uploaded
     \item Each of the copy of the worm \textbf{1805021\_3.py} would be unique in container $3$ and $4$
     \item The worm will now look for desired files at all levels of the directory recursively starting from the top-level
 \end{itemize}

  \subsection{Docker Container Information}
 The following function returns the ip addresses of the docker container $3$, from which all the file, starting at the top-level directory, at all directory levels containing the desired string \textbf{\textit{abracadabra}} will be exfiltrated:
\begin{center}
    \includegraphics[scale=0.3]{task3/attacked-host.png}
\end{center}

With the following line of code, we connect to the docker container $4$, where the exfiltrated files will be uploaded:
\begin{center}
    \includegraphics[scale=0.3]{task3/target-host.png}
\end{center}


\subsection{Obtain Target Files}
We find all \textbf{sorts} of files with the string \textbf{\textit{abracadabra}} starting at the top-level directory of the docker container $3$ at all directory levels executing the command below:
\begin{center}
    \includegraphics[scale=0.3]{task3/cmd.png}
\end{center}

The above command does the following things:
\begin{itemize}
    \item \textbf{find} utility is used to search for specific files starting from top-level recursively
    \item \textbf{-type f} option limits results of \textit{find} to only regular files
    \item \textbf{-exec} option is used to execute \textit{grep} command on each found file
    \item \textbf{grep} utility is used to match patterns
    \item \textbf{-ls} option is used to print paths of files matching \textit{grep} patterns
    \item \textbf{"abracadabra"} is the string pattern to be matched
    \item \textbf{\{\}} placeholder is used to represent each file discovered by \textit{find} command
    \item \textbf{+} indicates the end of \textit{-exec}. It batches found files and executes commands in a single call
\end{itemize}

We can see the following files being exfiltrated:
\begin{center}
    \includegraphics[scale=0.3]{task3/files.png}
\end{center}

A new portion added to the worm is the filtering of the file names after obtaining them from the attacked hosts.
\begin{center}
    \includegraphics[scale=0.3]{task3/filter-file-names.png}
\end{center}

It is due to the fact that the file structure in the attacking machine after obtaining the target files:
\begin{center}
    \includegraphics[scale=0.3]{task3/file-struct.png}
\end{center}


\subsection{Upload Exfiltrated Files}
After connecting to the container $4$, the exfiltrated files are uploaded normally as follows: 
\begin{center}
    \includegraphics[scale=0.3]{task1/file-transfer.png}
\end{center}


\subsection{Prepare Docker Containers}
We prepare the docker containers as follows:\\\\
The container $3$ has the following folder structure:
\begin{itemize}
    \item A \textit{txt} file \texttt{file1.txt} and a \textit{folder} named \texttt{test} at \textbf{\textit{top-level}}
    \item A \textit{foo} file \texttt{file2.foo} and a \textit{folder} named \texttt{folder} at \textbf{\textit{test}}
    \item A \textit{bar} file \texttt{file3.bar} at \textbf{\textit{folder}}
\end{itemize}
\begin{center}
    \includegraphics[scale=0.25]{task3/cont3.png}
\end{center}
The container $4$ is currently empty before the execution of the program.
\begin{center}
    \includegraphics[scale=0.25]{task3/cont4.png}
\end{center}


\subsection{Containers after Execution}
The program \textbf{1805021\_3.py} was run and the docker containers had the following desired states:\\\\

The container $3$ now has a modified copy of the attacking program, along with the files and folders it had before. 
\begin{center}
    \includegraphics[scale=0.25]{task3/cont3_after.png}
\end{center}

The container $4$ has the $3$ files from container $3$ with the desired string \textbf{\textit{abracadabra}} in them. 
\begin{center}
    \includegraphics[scale=0.25]{task3/cont4_after.png}
\end{center}

Thus, we can say that the worm \textbf{1805021\_3.py} can deposit unique copies into attacking machines and upload exfiltrated files recursively from the top-level directory into the target host.

\end{document}
